"use strict";(self.webpackChunksamurai_way=self.webpackChunksamurai_way||[]).push([[94],{3094:function(e,s,a){a.r(s),a.d(s,{DialogsContainer:function(){return F}});var i=a(8281),n=a(885),t=a(2791),l="Dialogs_dialogs__2l6L0",o="Dialogs_dialogWindow__2+7C3",r="Dialogs_messagesWindow__YVZuy",c="Dialogs_messages__8sGrY",d="DialogItem_dialogBlock__FvSlk",g="DialogItem_photoBlock__SsrEG",u="DialogItem_userPhoto__3cX6a",m="DialogItem_online__Nb+Xb",h="DialogItem_aboutBlock__JHNol",_="DialogItem_about__ivcwF",f="DialogItem_name__m0bqz",v="DialogItem_newMessages__hmnTi",x=a(3504),j=a(1313),D=a(5796),N=function(e){var s=Math.ceil((new Date).getTime()-new Date(e).getTime()),a=Math.ceil(s/1e3);return a<60?a+" min. ago":a>60&&a<1440?Math.ceil(a/60)+" h ago":a>1440&&a<43200?Math.ceil(a/1440)+" days ago":a>43200&&a<518400?Math.ceil(a/43200)+" months ago":a>518400?new Date(e).toLocaleString("en",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):void 0},M=function(e){var s=Math.ceil((new Date).getTime()-new Date(e).getTime());return Math.ceil(s/1e6)<15},w=a(184),p=t.memo((function(e){var s=e.dialogItem,a=s.id,n=s.photos,t=s.userName,l=s.hasNewMessages,o=s.newMessagesCount,r=s.lastUserActivityDate,c=s.lastDialogActivityDate,p=(0,j.T)(),C="/profile/"+a,I=N(r),T=N(c);Math.ceil(new Date(c).getTime());return(0,w.jsxs)("div",{className:d,children:[(0,w.jsxs)("div",{onClick:function(){p((0,i.AH)(a))},className:g,children:[(0,w.jsx)("img",{className:u,src:null!=n.small?n.small:D,alt:"avatar"}),M(r)&&(0,w.jsx)("div",{className:m})]}),(0,w.jsxs)("div",{className:h,children:[(0,w.jsxs)("div",{className:_,children:[(0,w.jsx)(x.OL,{to:C,title:"see profile",children:(0,w.jsx)("h5",{className:f,children:t})}),(0,w.jsxs)("h6",{children:["Last: ",(0,w.jsx)("span",{children:I})]}),(0,w.jsxs)("h6",{children:["Dialog: ",(0,w.jsx)("span",{children:T})]})]}),(0,w.jsxs)("div",{className:v,children:[" ",l?(0,w.jsxs)("span",{style:{color:"limegreen"},children:["New ",o," messages"]}):""]})]})]})})),C={messageBlock:"Message_messageBlock__USaat",nameData:"Message_nameData__goYo2",name:"Message_name__634Ny",dateAdd:"Message_dateAdd__eS4BZ",message:"Message_message__O4Hlp",left:"Message_left__2TEFf",right:"Message_right__x0Zcr"},I=function(e){var s=e.message,a=e.userId,i=s.senderId===a?C.right:C.left;return(0,w.jsxs)("div",{className:"".concat(C.messageBlock," ").concat(i),children:[(0,w.jsxs)("div",{className:C.nameData,children:[(0,w.jsx)("h5",{className:C.name,children:s.senderName}),(0,w.jsx)("span",{className:C.dateAdd,children:N(s.addedAt)})]}),(0,w.jsx)("div",{className:C.body,children:(0,w.jsx)("p",{className:C.message,children:s.body})})]},s.id)},T=a(7945),k=a(6899),y="SendMessage_sendMessage__ka75X",S="SendMessage_buttonBlock__tfpM7",b=function(e){var s=e.userId,a=(0,j.C)((function(e){return e.dialogsPage.isFetching})),l=(0,t.useState)(""),o=(0,n.Z)(l,2),r=o[0],c=o[1],d=(0,j.T)();console.log("SendMessageForm",s);return(0,w.jsxs)("div",{className:y,children:[(0,w.jsx)("div",{children:(0,w.jsx)(T.iF,{onChange:function(e){return c(e.currentTarget.value)},value:r})}),(0,w.jsx)("div",{className:S,children:(0,w.jsx)(k.z,{disabled:a,onClick:function(){r&&(d((0,i.CJ)(s,r)),c(""))},children:"Send"})})]})},P=t.memo((function(e){var s=(0,j.T)(),a=(0,j.C)((function(e){return e.dialogsPage.dialogs})),d=(0,j.C)((function(e){return e.dialogsPage.messages})),g=(0,j.C)((function(e){return e.dialogsPage.userId})),u=(0,j.C)((function(e){return e.dialogsPage.totalCount})),m=(0,t.useState)(!0),h=(0,n.Z)(m,2),_=h[0],f=h[1],v=(0,t.useState)(1),x=(0,n.Z)(v,2),D=x[0],N=x[1],M=(0,t.useRef)(null),C=(0,t.useRef)(null);return(0,t.useEffect)((function(){var e;_&&(null===(e=C.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[d,_]),(0,t.useEffect)((function(){s((0,i.UP)())}),[s,g]),(0,w.jsxs)("div",{className:l,children:[(0,w.jsx)("div",{style:{height:"650px",overflowY:"auto"},className:o,children:a&&a.map((function(e){return(0,w.jsx)(p,{dialogItem:e},e.id)}))}),(0,w.jsxs)("div",{className:r,children:[(0,w.jsxs)("div",{style:{height:"480px",overflowY:"auto"},className:c,onScroll:function(e){var s=e.currentTarget;s.scrollTop<=0&&u>10*D&&N(D+1),s.scrollHeight-s.scrollTop===s.clientHeight?!_&&f(!0):_&&f(!1)},children:[(0,w.jsx)("div",{ref:M}),d&&d.map((function(e){return(0,w.jsx)(I,{message:e,userId:g},e.id)})),(0,w.jsx)("div",{ref:C})]}),(0,w.jsx)(b,{userId:g})]})]})})),A=a(8687),B=a(2932),F=(0,a(7781).qC)((0,A.$j)((function(e){return{dialogsPage:e.dialogsPage.dialogs,isAuth:e.auth.isAuth}}),{newTextMessageOnChange:i.Hw,sendMessageTC:i.CJ,getDialogsTC:i.UP}),B.e)(P)}}]);
//# sourceMappingURL=94.9403f21b.chunk.js.map